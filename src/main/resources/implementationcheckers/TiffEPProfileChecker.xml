<?xml version="1.0" encoding="UTF-8"?>
<implementationCheckerObject>
 
 <title>Tiff EP Implementation Checker</title>

 <description>ISO 12234-2:2001(E)</description>
 
 <include>BaselineProfileChecker.xml</include>
    
 <rules description="tiffep-structure">
     <rule id="ep-1" context="ifd[class=image]">
         <assert test="{count(tags.tag[name=SubIFDs]) == 1}">Each IFD must have a sub-ifd</assert>
         <reference>Page 7</reference>
     </rule>
     <rule id="ep-2" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd}">Each IFD must have a sub-ifd</assert>
         <reference>Page 7</reference>
     </rule>
     <rule id="ep-3" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=ImageLength] > tags.tag[name=ImageLength]}">Sub-ifd size must be greater than thumbnail IFD</assert>
         <reference>Page 6</reference>
     </rule>
     <rule id="ep-4" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=ImageWidth] > tags.tag[name=ImageWidth]}">Sub-ifd size must be greater than thumbnail IFD</assert>
         <reference>Page 6</reference>
     </rule>
     <rule id="ep-5" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=NewSubfileType]}">NewSubfileType is required</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-6" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=NewSubfileType].cardinality == 1}">NewSubfileType cardinality must be 1</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-7" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=NewSubfileType] == 0} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=NewSubfileType] == 1}">NewSubfileType must be 0 or 1</assert>
         <reference>Page 17</reference>
     </rule>
     <rule id="ep-8" context="ifd[class=image]">
         <assert test="{tags.tag[name=NewSubfileType] == 1}">NewSubfileType must be 1 for main IFDs</assert>
         <reference>Page 17</reference>
     </rule>
     <rule id="ep-9" context="subifd">
         <assert test="{tags.tag[name=NewSubfileType] == 0}">NewSubfileType must be 0 for thumbnail IFDs</assert>
         <reference>Page 17</reference>
     </rule>
     <rule id="ep-10" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs]}">IFDs must have SubIFDs</assert>
         <reference>Page 7</reference>
     </rule>
     <rule id="ep-11" context="ifd[class=image]">
         <assert test="{strips == 1}">Thumbnail image must be stored in strips</assert>
         <reference>Page 7</reference>
     </rule>
 </rules>
     
 <rules description="mandatory-tags">
     <rule id="ep-12" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=ImageDescription]}">ImageDescription tag is required</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-13" context="ifd[class=image]">
         <assert test="{tags.tag[name=SamplesPerPixel]}">Tag is required</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-14" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=ImageLength].cardinality == 1}">Tag cardinality must be 1</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-15" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=ImageWidth].cardinality == 1}">Tag cardinality must be 1</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-16" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=Compression].cardinality == 1}">Tag cardinality must be 1</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-17" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=XResolution]}">Tag is required</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-18" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=YResolution]}">Tag is required</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-19" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=XResolution].cardinality == 1}">Tag cardinality must be 1</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-20" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=YResolution].cardinality == 1}">Tag cardinality must be 1</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-21" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=Make]}">Tag is required</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-22" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=Model]}">Tag is required</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-23" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=Software]}">Tag is required</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-24" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=Copyright]}">Tag is required</assert>
         <reference>Page 14</reference>
     </rule>
     <rule id="ep-25" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=DateTimeOriginal]}">Tag is required</assert>
         <reference>Page 14</reference>
     </rule>
     <rule id="ep-26" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=DateTimeOriginal].cardinality == 20}">DateTime length must be 20</assert>
         <reference>Page 14</reference>
     </rule>
     <rule id="ep-27" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=DateTime].cardinality == 20}">DateTime length must be 20</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-28" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=TIFFEPStandardID]}">Tag is required</assert>
         <reference>Page 15</reference>
     </rule>
     <rule id="ep-29" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=TIFFEPStandardID].cardinality == 4}">TIFFEPStandardID value must be 4</assert>
         <reference>Page 15</reference>
     </rule>
     <rule id="ep-30" context="ifd[class=image]">
         <assert test="{correctCompression}">CompressedBitsPerPixel tag is forbidden when Compression is 1</assert>
         <reference>Page 14</reference>
     </rule>
     <rule id="ep-31" context="ifd[class=image]">
         <assert test="{tags.tag[name=Compression] == 1}">Compression must be 1 for the thumbnail</assert>
         <reference>Page 27</reference>
     </rule>
 </rules>
    
 <rules description="restricted-tags">
     <rule id="ep-32" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=PhotometricInterpretation] == 1} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=PhotometricInterpretation] == 2} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=PhotometricInterpretation] == 6} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=PhotometricInterpretation] == 32803} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=PhotometricInterpretation] == 32767}">Photometric Interpretation value must be 1, 2, 6, 32803 or 32767</assert>
         <reference>Page 21</reference>
    </rule>
     <rule id="ep-33" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=PlanarConfiguration]}">PlanarConfiguration tag is required</assert>
         <reference>Page 13</reference>
    </rule>
     <rule id="ep-34" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=PlanarConfiguration].cardinality == 1}">PlanarConfiguration cardinality must be 1</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-35" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=PlanarConfiguration] == 1} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=PlanarConfiguration] == 2}">PlanarConfiguration value must be 1 or 2</assert>
         <reference>Page 21</reference>
    </rule>
     <rule id="ep-36" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=ResolutionUnit]}">ResolutionUnit tag is required</assert>
         <reference>Page 13</reference>
    </rule>
     <rule id="ep-37" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=ResolutionUnit].cardinality == 1}">ResolutionUnit cardinality must be 1</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-38" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=ResolutionUnit] == 1} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=ResolutionUnit] == 2} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=ResolutionUnit] == 3}">ResolutionUnit value must be 1, 2 or 3</assert>
         <reference>Page 18</reference>
    </rule>
     <rule id="ep-39" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=Orientation].cardinality == 1}">Orientation cardinality must be 1</assert>
         <reference>Page 13</reference>
     </rule>
     <rule id="ep-40" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=Orientation] == 1} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Orientation] == 3} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Orientation] == 6} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Orientation] == 8} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Orientation] == 9}">Orientation value must be 1, 3, 6, 8 or 9</assert>
         <reference>Page 20</reference>
    </rule>
     <rule id="ep-41" context="ifd[class=image]">
         <assert test="{correctPhotometricCasuistic == 1}">Invalid photometric interpretation fields</assert>
         <reference>Page 21</reference>
     </rule>
     <rule id="ep-42" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=TimeZoneOffset] > 11} &amp;&amp; {tags.tag[name=SubIFDs].ifd.tags.tag[name=TimeZoneOffset] &lt; -12}">TimeZoneOffset value must be between -12 and 11</assert>
         <reference>Page 38</reference>
     </rule>
     <rule id="ep-43" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=ExposureProgram] == 0} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=ExposureProgram] == 1} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=ExposureProgram] == 2} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=ExposureProgram] == 3} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=ExposureProgram] == 4} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=ExposureProgram] == 5} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=ExposureProgram] == 6} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=ExposureProgram] == 7} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=ExposureProgram] == 8} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=ExposureProgram] &gt; 32767}">ExposureProgram value must be between 0 and 8 or greater than 32767</assert>
         <reference>Page 41</reference>
     </rule>
     <rule id="ep-44" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=MeteringMode] == 0} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=MeteringMode] == 1} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=MeteringMode] == 2} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=MeteringMode] == 3} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=MeteringMode] == 4} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=MeteringMode] &gt; 32767}">MeteringMode value must be between 0 and 4 or greater than 32767</assert>
         <reference>Page 42</reference>
     </rule>
     <rule id="ep-45" context="ifd[class=image]">
         <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 0} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 1} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 5} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 7} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 9} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 13} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 15} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 16} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 24} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 25} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 29} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 31} || {tags.tag[name=SubIFDs].ifd.tags.tag[name=Flash] == 32}">Flash value not allowed</assert>
         <reference>Page 43</reference>
     </rule>
 </rules>
    
 <rules description="forbidden-and-restricted-tags">
     <rule id="ep-46" context="ifd[class=image]">
        <assert test="{correctYcbcr == 1}">Invalid Ycbcr parameters</assert>
         <reference>Page 14</reference>
    </rule>
    <rule id="ep-47" context="tags">
        <assert test="{!tag[name=PrimaryChromaticities]}">PrimaryChromaticities tag is forbidden</assert>
        <reference></reference>
    </rule>
    <rule id="ep-48" context="tags">
        <assert test="{!tag[name=WhitePoint]}">WhitePoint tag is forbidden</assert>
        <reference></reference>
    </rule>
    <rule id="ep-49" context="tags">
        <assert test="{!tag[name=TransferFunction]}">TransferFunction tag is forbidden</assert>
        <reference></reference>
    </rule>
     <rule id="ep-50" context="ifd[class=image]">
        <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=FocalPlaneResolutionUnit] > 0} &amp;&amp; {tags.tag[name=SubIFDs].ifd.tags.tag[name=FocalPlaneResolutionUnitUnit] &lt; 6}">FocalPlaneResolutionUnit value must be between 1 and 5</assert>
         <reference>Page 19</reference>
    </rule>
     <rule id="ep-51" context="ifd[class=image]">
        <assert test="{tags.tag[name=SubIFDs].ifd.tags.tag[name=SensingMethod] > -1} &amp;&amp; {tags.tag[name=SubIFDs].ifd.tags.tag[name=SensingMethod] &lt; 9}">SensingMethod value must be between 0 and 8</assert>
         <reference>Page 19</reference>
    </rule>
 </rules>

</implementationCheckerObject>
